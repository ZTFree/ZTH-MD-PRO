<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ÄÁªøÂêëÂåóüíö</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .ctrl {
            display: block;
            width: 600px;
            /* width: 100%; */
            margin: 0 auto;
        }

        .outerbox {
            margin: 20px auto;
            display: flex;
            width: 600px;
            flex-direction: column;
            height: 500px;
            overflow-y: scroll;
            border: 10px solid black;
            background-size: cover;
            background-position: center;

        }

        .outerbox::-webkit-scrollbar {
            visibility: hidden;
            width: 0;
        }

        .innerbox {

            padding: 0px;
            background-color: rgba(128, 128, 128, 0.5)
        }

        .row {
            margin: 5px 0;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            color: rgb(9, 255, 5);
        }

        .active {
            background-color: rgba(95, 244, 157, 0.5);
            color: rgb(255, 0, 0);
        }

        .title {
            text-align: center;
            margin-top: 20px;
            color: green;
        }
    </style>
</head>

<body>
    <div class="main">
        <h1 class="title"></h1>
        <div class="outerbox">
            <div class="innerbox"></div>
        </div>
        <audio src="./audios/ylxb.mp3" controls class="ctrl" autoplay></audio>
    </div>


</body>

</html>

<script>
    const title = document.querySelector('.title')
    const ctrl = document.querySelector('.ctrl')
    const outerbox = document.querySelector('.outerbox')
    const innerbox = document.querySelector('.innerbox')

    const fullStr = `
[00:00.00]Âë®Êù∞‰º¶ - ‰∏ÄË∑ØÂêëÂåó
[00:18.04]‰ΩúËØçÔºöÊñπÊñáÂ±±
[00:24.95]‰ΩúÊõ≤ÔºöÂë®Êù∞‰º¶
[00:31.32]ÁºñÊõ≤ÔºöËî°Áßë‰øä
[00:36.07]ÂæåËßÜÈïúÈáåÁöÑ‰∏ñÁïå
[00:43.13]Ë∂äÊù•Ë∂äËøúÁöÑÈÅìÂà´
[00:47.74]‰Ω†ËΩ¨Ë∫´ÂêëËÉå
[00:50.79]‰æßËÑ∏ËøòÊòØÂæàÁæé
[00:54.34]ÊàëÁî®ÁúºÂÖâÂéªËøΩ
[00:57.92]Á´üÂê¨ËßÅ‰Ω†ÁöÑÊ≥™
[01:04.57]Âú®ËΩ¶Á™óÂ§ñÈù¢ÊéíÂæä
[01:11.77]ÊòØÊàëÈîôÂ§±ÁöÑÊú∫‰ºö
[01:16.28]‰Ω†Á´ôÁöÑÊñπ‰Ωç
[01:18.84]Ë∑üÊàë‰∏≠Èó¥ÈöîËëóÊ≥™
[01:22.39]Ë°óÊôØ‰∏ÄÁõ¥Âú®ÂæåÈÄÄ
[01:26.08]‰Ω†ÁöÑÂ¥©Ê∫ÉÂú®Á™óÂ§ñÈõ∂Á¢é
[01:30.16]Êàë‰∏ÄË∑ØÂêëÂåó
[01:33.02]Á¶ªÂºÄÊúâ‰Ω†ÁöÑÂ≠£ËäÇ
[01:37.70]‰Ω†ËØ¥‰Ω†Â•ΩÁ¥Ø
[01:40.26]Â∑≤Êó†Ê≥ïÂÜçÁà±‰∏äË∞Å
[01:44.51]È£éÂú®Â±±Ë∑ØÂêπ
[01:47.05]ËøáÂæÄÁöÑÁîªÈù¢ÂÖ®ÈÉΩÊòØÊàë‰∏çÂØπ
[01:52.51]ÁªÜÊï∞ÊÉ≠ÊÑß
[01:54.68]Êàë‰º§‰Ω†Âá†Âõû
[02:04.27]
[02:10.46]
[02:19.58]ÂæåËßÜÈïúÈáåÁöÑ‰∏ñÁïå
[02:26.79]Ë∂äÊù•Ë∂äËøúÁöÑÈÅìÂà´
[02:31.30]‰Ω†ËΩ¨Ë∫´ÂêëËÉå
[02:34.52]‰æßËÑ∏ËøòÊòØÂæàÁæé
[02:37.95]ÊàëÁî®ÁúºÂÖâÂéªËøΩ
[02:41.58]Á´üÂê¨ËßÅ‰Ω†ÁöÑÊ≥™
[02:48.19]Âú®ËΩ¶Á™óÂ§ñÈù¢ÊéíÂæä
[02:55.28]ÊòØÊàëÈîôÂ§±ÁöÑÊú∫‰ºö
[03:00.43]‰Ω†Á´ôÁöÑÊñπ‰Ωç
[03:02.38]Ë∑üÊàë‰∏≠Èó¥ÈöîËëóÊ≥™
[03:05.86]Ë°óÊôØ‰∏ÄÁõ¥Âú®ÂæåÈÄÄ
[03:09.55]‰Ω†ÁöÑÂ¥©Ê∫ÉÂú®Á™óÂ§ñÈõ∂Á¢é
[03:13.95]Êàë‰∏ÄË∑ØÂêëÂåó
[03:16.71]Á¶ªÂºÄÊúâ‰Ω†ÁöÑÂ≠£ËäÇ
[03:21.10]‰Ω†ËØ¥‰Ω†Â•ΩÁ¥Ø
[03:23.85]Â∑≤Êó†Ê≥ïÂÜçÁà±‰∏äË∞Å
[03:28.40]È£éÂú®Â±±Ë∑ØÂêπ
[03:31.08]ËøáÂæÄÁöÑÁîªÈù¢ÂÖ®ÈÉΩÊòØÊàë‰∏çÂØπ
[03:36.31]ÁªÜÊï∞ÊÉ≠ÊÑß
[03:38.42]Êàë‰º§‰Ω†Âá†Âõû
[03:42.81]Êàë‰∏ÄË∑ØÂêëÂåó
[03:45.38]Á¶ªÂºÄÊúâ‰Ω†ÁöÑÂ≠£ËäÇ
[03:49.96]ÊñπÂêëÁõòÂë®Âõ¥
[03:52.74]ÂõûËΩ¨ËëóÊàëÁöÑÂæåÊÇî
[03:57.86]ÊàëÂä†ÈÄüË∂ÖË∂ä
[03:59.80]Âç¥Áî©‰∏çÊéâÁ¥ßÁ¥ßË∑üÈöèÁöÑ‰º§ÊÇ≤
[04:05.08]ÁªÜÊï∞ÊÉ≠ÊÑß
[04:07.25]Êàë‰º§‰Ω†Âá†Âõû
[04:12.63]ÂÅúÊ≠¢ÁãºÁãà
[04:14.37]Â∞±ËÆ©ÈîôÁ∫ØÁ≤π
[04:22.82]`

    const wordsArr = []
    const timesArr = []
    const rowsArr = []

    const bgRootUrl = './images'
    const bgUrlArr = ['bg00.jpg', 'bg01.jpg', 'bg02.jpg', 'bg03.jpg']

    let bgIndex = 0


    let rollTimer;
    let isRolling = false



    // ÂàùÂßãÂåñÊï∞ÁªÑÊï∞ÊçÆ
    function initArr() {
        fullStr.split('\n').forEach(v => {
            if (!v) return
            const timeStr = (v.match(/\[.*\]/))[0]
            const m = parseInt(timeStr.slice(1, 3)),
                s = parseInt(timeStr.slice(4, 6)),
                ws = parseInt(timeStr.slice(7, 9))
            const time = m * 60 + s + ws / 100
            timesArr.push(time)

            const wordStr = v.replace(timeStr, '')
            wordsArr.push(wordStr)

        })

        wordsArr.forEach((v, i) => {
            const row = document.createElement('div')
            row.classList.add('row')
            row.innerText = v
            rowsArr.push(row)
            innerbox.appendChild(row)
        })
    }

    // ÁÇπÂáªËøõÂ∫¶Êù°ÊøÄÊ¥ªË°å
    function setRowActiveByTime() {
        const curTime = ctrl.currentTime
        if (curTime <= 0) return
        timesArr.some((v, i) => {

            if (curTime <= v) {
                doRowActive(i - 1)
                return true
            }
            else if (curTime > timesArr[timesArr.length - 1]) {
                doRowActive(timesArr.length - 1)
                return true
            }
        })
    }

    // Ëá™Âä®ÂàáÊç¢ËÉåÊôØ
    function setAutoBackground() {
        setInterval(() => {
            bgIndex = bgIndex + 1 >= bgUrlArr.length ? 0 : bgIndex + 1
            outerbox.style.backgroundImage = `url(${bgRootUrl + '/' + bgUrlArr[bgIndex]})`
        }, 5000);
    }

    // Ê≠åËØçËá™Âä®Ë∑≥ËΩ¨ÊøÄÊ¥ª
    function setAutoTimer() {
        setInterval(() => {
            setRowActiveByTime()
        }, 10)
    }

    // Ë∑≥ËΩ¨+ÊøÄÊ¥ªÊ†∑Âºè
    function doRowActive(index) {
        rowJump(index)
        setActiveStyle(index)
    }

    // ÊªöÂä®Êù°Ë∑≥ËΩ¨
    function rowJump(index) {
        if (isRolling) return
        const curRow = rowsArr[index]
        outerbox.scrollTo(0, curRow.offsetTop - outerbox.clientHeight / 2 - curRow.clientHeight / 2 + 50)
    }

    // ËÆæÁΩÆÊí≠ÊîæÂô®Êó∂Èó¥ËøõÂ∫¶
    function setPlayerTime(time) {
        ctrl.currentTime = time
    }

    // ÊøÄÊ¥ªÊ†∑Âºè
    function setActiveStyle(index) {
        const curRow = rowsArr[index]
        rowsArr.forEach(v => {
            v.classList.remove('active')
        })
        curRow.classList.add('active')
    }

    function init() {
        initArr()
        setAutoTimer()
        setAutoBackground()

        title.innerText = '‰∏ÄË∑ØÂêëÂåó'
        outerbox.style.backgroundImage = `url(${bgRootUrl + '/' + bgUrlArr[bgIndex]})`

        // ÁªëÂÆöÊí≠ÊîæÂô®ËøõÂ∫¶ÁÇπÂáª‰∫ã‰ª∂
        ctrl.addEventListener('seeked', (e) => {
            setRowActiveByTime()
        })

        // ÁªëÂÆöÊ≠åËØçÊªöÂä®Êü•Áúã‰∫ã‰ª∂
        outerbox.addEventListener('wheel', (e) => {
            isRolling = true
            clearTimeout(rollTimer)
            rollTimer = setTimeout(() => {
                isRolling = false
            }, 1000);
        })

        // ÁªëÂÆöÊ≠åËØçÁÇπÂáªË∑≥ËΩ¨‰∫ã‰ª∂
        innerbox.addEventListener('click', ({ target }) => {
            if (target.classList.contains('row')) {
                const index = rowsArr.indexOf(target)
                setPlayerTime(timesArr[index])
            }
        })
    }
    init()



</script>